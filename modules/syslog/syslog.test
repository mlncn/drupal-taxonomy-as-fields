<?php
// $Id: syslog.test,v 1.8 2009/07/13 21:51:42 webchick Exp $

class SyslogTestCase extends DrupalWebTestCase {
  public static function getInfo() {
    return array(
      'name' => 'Syslog functionality',
      'description' => 'Test syslog settings.',
      'group' => 'Syslog'
    );
  }

  function setUp() {
    parent::setUp('syslog');
  }

  /**
   * Test the syslog settings page.
   */
  function testSettings() {
    $admin_user = $this->drupalCreateUser(array('administer site configuration'));
    $this->drupalLogin($admin_user);

    $edit = array();
    // If we're on Windows, LOG_LOCAL6 will not be available.
    if (defined('LOG_LOCAL6')) {
      $edit['syslog_facility'] = LOG_LOCAL6;
    }
    else {
      $edit['syslog_facility'] = LOG_USER;
    }
    $this->drupalPost('admin/settings/logging', $edit, t('Save configuration'));
    $this->assertText(t('The configuration options have been saved.'));

    $this->drupalGet('admin/settings/logging');
    if ($this->parse()) {
      $field = $this->xpath('//option[@value="' . $edit['syslog_facility'] . '"]'); // Should be one field.
      $this->assertTrue($field[0]['selected'] == 'selected', t('Facility value saved.'));
    }
  }
}
